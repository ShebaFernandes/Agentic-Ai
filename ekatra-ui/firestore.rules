rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Only authenticated users
    match /{document=**} {
      allow read, write: if request.auth != null;
    }

    // Teachers
    match /teachers/{userId} {
      allow read, write: if request.auth.uid == userId;
    }

    // Classes under a teacher
    match /teachers/{userId}/classes/{classId} {
      allow read, write: if request.auth.uid == userId;
    }

    // Lessons, quizzes, schedules under teacher
    match /teachers/{userId}/{collection}/{docId} {
      allow read, write: if request.auth.uid == userId
        && collection in ['lessons','quizzes','schedules','feedback'];
    }

    // Students
    match /students/{studentId} {
      allow read, write: if request.auth != null;
    }

    // Sessions
    match /sessions/{sessionId} {
      allow read, write: if request.auth != null;
    }
  }
}